<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micronutrient Reference Values for Children</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            height: 500px;
            width: 100%;
        }
        /* Custom checkbox style */
        .custom-checkbox:checked {
            background-color: currentColor;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
        /* Custom smaller font for the footer */
        .footer-text-custom {
            font-size: 0.5rem; /* text-xs'den (0.75rem) daha küçük */
            line-height: 0.6rem; /* Okunabilirliği artırmak için satır yüksekliği */
        }
    </style>
</head>
<body class="text-gray-800">

<div class="container mx-auto p-4 sm:p-6 md:p-8 relative">
    <div class="absolute top-4 right-4 sm:top-6 sm:right-6 md:top-8 md:right-8 z-10">
        <button onclick="switchLanguage('tr')" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-l-md">TR</button>
        <button onclick="switchLanguage('en')" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-r-md">EN</button>
    </div>
    <header class="text-center mb-10">
            <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-gray-900">Mikrobesin Referans Değerleri</h1>
            <p id="subtitle" class="mt-2 text-md text-gray-600">EFSA, FNB ve TFC verilerinin 0-18 yaş aralığı için karşılaştırmalı analizi</p>
        </header>

        <main>
            <div class="max-w-xl mx-auto mb-8">
                <label for="nutrient-select" id="nutrient-select-label" class="block text-sm font-medium text-gray-700 mb-2">Analiz Edilecek Mikrobesini Seçin:</label>
                <select id="nutrient-select" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 shadow-sm transition duration-150 ease-in-out">
                    </select>
            </div>

            <div id="charts-wrapper" class="space-y-12">
                </div>

            <div id="controls-container" class="mt-8 p-6 bg-white rounded-xl shadow-md max-w-2xl mx-auto">
                 <h3 id="controls-title" class="text-lg font-semibold text-center mb-4 text-gray-800">Grafik Kontrolleri</h3>
                 <div id="checkbox-controls" class="flex justify-center items-center gap-6 sm:gap-8 flex-wrap">
                    </div>
            </div>
        </main>

        <footer id="footer" class="mt-12 pt-8 border-t border-gray-200 footer-text-custom text-gray-500">
            <div class="max-w-7xl mx-auto px-4">
                <h2 id="disclaimer-title" class="font-semibold text-gray-800 mb-4"></h2>
                <p id="disclaimer-last-updated" class="mb-4"></p>
                <p id="disclaimer-intro" class="mb-4"></p>
        
                <h3 id="disclaimer-general-title" class="font-semibold text-gray-700 mt-4 mb-2"></h3>
                <p id="disclaimer-general-content" class="mb-4"></p>
                <p id="disclaimer-medical-advice" class="mb-4"></p>
        
                <h3 id="disclaimer-accuracy-title" class="font-semibold text-gray-700 mt-4 mb-2"></h3>
                <p id="disclaimer-accuracy-content" class="mb-4"></p>
        
                <h3 id="disclaimer-regional-title" class="font-semibold text-gray-700 mt-4 mb-2"></h3>
                <div id="disclaimer-regional-content">
                    <p class="mb-2"><strong id="disclaimer-regional-tr-title"></strong>: <span id="disclaimer-regional-tr-content"></span></p>
                    <p class="mb-2"><strong id="disclaimer-regional-eu-title"></strong>: <span id="disclaimer-regional-eu-content"></span></p>
                    <p class="mb-2"><strong id="disclaimer-regional-us-title"></strong>: <span id="disclaimer-regional-us-content"></span></p>
                </div>
        
                <h3 id="disclaimer-ip-title" class="font-semibold text-gray-700 mt-4 mb-2"></h3>
                <p id="disclaimer-ip-content" class="mb-4"></p>
                <p id="disclaimer-rights-reserved" class="text-xs text-center mt-8"></p>
            </div>
        </footer>
    </div>
    
    <script src="data.js"></script>
    <script>
        // --- TRANSLATION DATA ---
        const translations = {
            tr: {
                title: "Mikrobesin Referans Değerleri",
                subtitle: "EFSA, FNB ve TFC verilerinin 0-18 yaş aralığı için karşılaştırmalı analizi",
                nutrientSelectLabel: "Analiz Edilecek Mikrobesini Seçin:",
                selectPlaceholder: "Bir mikrobesin seçin...",
                controlsTitle: "Grafik Kontrolleri",
                intakeChartTitle: "Önerilen Alım Değerleri",
                ulChartTitle: "Üst Limit Değerleri",
                yAxisLabel: (unit) => `Değer (${unit})`,
                xAxisLabel: "Yaş",
                noDataMessage: "Bu kategori için veri bulunamadı.",
                genderMale: "Erkek",
                genderFemale: "Kadın",
                disclaimerTitle: "Yasal Uyarılar ve Kullanım Koşulları",
                disclaimerLastUpdated: "Son Güncelleme Tarihi: 30.08.2025",
                disclaimerIntro: "Lütfen bu web sitesini kullanmadan önce aşağıdaki yasal uyarıları ve kullanım koşullarını dikkatlice okuyunuz. Bu siteyi kullanarak, bu koşulları kabul etmiş sayılırsınız.",
                disclaimerGeneralTitle: "1. Genel Yasal Uyarı",
                disclaimerGeneralContent: "Bu web sitesinde ('Site') sunulan içerikler, yalnızca genel bilgilendirme ve eğitim amacıyla hazırlanmıştır. Sitede yer alan bilgiler, Avrupa Gıda Güvenliği Otoritesi (EFSA) (https://www.efsa.europa.eu), ABD Gıda ve Beslenme Kurulu (FNB) (https://www.nationalacademies.org/fnb/food-and-nutrition-board) ve Türk Gıda Kodeksi (TFC) (https://www.tarimorman.gov.tr/Konular/Gida-Ve-Yem-Hizmetleri/Gida-Hizmetleri/Kodeks) gibi kamuya açık kaynaklardan derlenen mikrobesin referans değerlerini karşılaştırmalı olarak sunmaktadır.",
                disclaimerMedicalAdvice: "Bu Sitedeki hiçbir bilgi, profesyonel tıbbi tavsiye, teşhis veya tedavinin yerini alamaz. Beslenme düzeninizde veya yaşam tarzınızda herhangi bir değişiklik yapmadan, bir takviye kullanmaya başlamadan veya sağlıkla ilgili herhangi bir konuda karar vermeden önce mutlaka yetkili bir hekime, diyetisyene veya diğer nitelikli sağlık uzmanlarına danışmanız esastır. Sağlığınızla ilgili endişeleriniz için profesyonel tıbbi yardım almayı asla geciktirmeyin veya bu Sitede okuduğunuz bilgiler nedeniyle göz ardı etmeyin.",
                disclaimerAccuracyTitle: "2. Veri Doğruluğu ve Sorumluluk Reddi",
                disclaimerAccuracyContent: "Sitede sunulan verilerin doğruluğu, eksiksizliği ve güncelliği konusunda azami özen gösterilmekle birlikte, herhangi bir garanti verilmemektedir. Veriler, orijinal kaynak otoriteler tarafından güncellenebilir, değiştirilebilir veya düzeltilebilir. Bu nedenle, Sitedeki bilgilerin kullanımından veya bu bilgilere dayanarak alınan kararlardan kaynaklanabilecek doğrudan veya dolaylı hiçbir zarar, kayıp veya hasardan Site sahibi sorumlu tutulamaz. Sitenin kullanım riski tamamen kullanıcıya aittir.",
                disclaimerRegionalTitle: "3. Bölgesel Yasal Uyum Metinleri",
                disclaimerRegionalTrTitle: "Türkiye Cumhuriyeti için",
                disclaimerRegionalTrContent: "Bu Site, Türkiye Cumhuriyeti Sağlık Bakanlığı'nın düzenlemelerine tabidir. Sitede yer alan bilgiler, 'Türk Gıda Kodeksi Beslenme ve Sağlık Beyanları Yönetmeliği' çerçevesinde yorumlanmalıdır. Bu site, hastalıkların önlenmesi veya tedavi edilmesi amacıyla kullanılamaz ve bu yönde bir iddia taşımamaktadır.",
                disclaimerRegionalEuTitle: "Avrupa Birliği (AB) için",
                disclaimerRegionalEuContent: "Sitede sunulan EFSA verileri, kurumun bilimsel görüşlerine dayanmaktadır ancak bu bilgiler bireysel sağlık tavsiyesi niteliği taşımaz. Bu Sitede, GDPR (Genel Veri Koruma Tüzüğü) uyarınca herhangi bir kişisel veri toplanmamakta veya işlenmemektedir.",
                disclaimerRegionalUsTitle: "Amerika Birleşik Devletleri (ABD) için",
                disclaimerRegionalUsContent: "Bu beyanlar, Gıda ve İlaç Dairesi tarafından değerlendirilmemiştir. Bu Sitede sunulan bilgiler, herhangi bir hastalığı teşhis etme, tedavi etme, iyileştirme veya önleme amacı gütmemektedir.",
                disclaimerIpTitle: "4. Fikri Mülkiyet Uyarısı",
                disclaimerIpContent: "Bu Sitenin tasarımı, metinleri, grafikleri, kodları ve diğer tüm içeriği telif hakkı ile korunmaktadır. Site sahibinin yazılı izni olmaksızın hiçbir materyal kopyalanamaz, çoğaltılamaz, dağıtılamaz veya başka bir şekilde kullanılamaz.",
                disclaimerRightsReserved: "Tüm Hakları Saklıdır."
            },
            en: {
                title: "Micronutrient Reference Values",
                subtitle: "Comparative analysis of EFSA, FNB, and TFC data for the 0-18 age range",
                nutrientSelectLabel: "Select Micronutrient to Analyze:",
                selectPlaceholder: "Select a micronutrient...",
                controlsTitle: "Chart Controls",
                intakeChartTitle: "Recommended Intake Values",
                ulChartTitle: "Upper Limit Values",
                yAxisLabel: (unit) => `Value (${unit})`,
                xAxisLabel: "Age",
                noDataMessage: "No data available for this category.",
                genderMale: "Male",
                genderFemale: "Female",
                disclaimerTitle: "Disclaimer and Terms of Use",
                disclaimerLastUpdated: "Last Updated: August 30, 2025",
                disclaimerIntro: "Please read the following disclaimers and terms of use carefully before using this website. By using this site, you agree to these terms.",
                disclaimerGeneralTitle: "1. General Disclaimer",
                disclaimerGeneralContent: "The content provided on this website (the 'Site') is for general informational and educational purposes only. The information presented on the Site offers a comparative analysis of micronutrient reference values compiled from publicly available sources, including the European Food Safety Authority (EFSA) (https://www.efsa.europa.eu), the U.S. Food and Nutrition Board (FNB) (https://www.nationalacademies.org/fnb/food-and-nutrition-board), and the Turkish Food Codex (TFC) (https://www.tarimorman.gov.tr/Konular/Gida-Ve-Yem-Hizmetleri/Gida-Hizmetleri/Kodeks).",
                disclaimerMedicalAdvice: "None of the information on this Site is a substitute for professional medical advice, diagnosis, or treatment. It is essential that you consult an authorized physician, registered dietitian, or other qualified health provider before making any changes to your diet or lifestyle, starting a supplement regimen, or making any decisions regarding a health condition. Never delay seeking professional medical advice or disregard it because of something you have read on this Site.",
                disclaimerAccuracyTitle: "2. Data Accuracy and Limitation of Liability",
                disclaimerAccuracyContent: "While utmost care is taken to ensure the accuracy, completeness, and timeliness of the data presented on the Site, no warranty is provided. The data may be updated, modified, or corrected by the original source authorities over time. Therefore, the owner of the Site shall not be held liable for any direct or indirect damages, losses, or harm arising from the use of or reliance on the information contained herein. The use of this Site is entirely at the user's own risk.",
                disclaimerRegionalTitle: "3. Region-Specific Legal Notices",
                disclaimerRegionalTrTitle: "For the Republic of Turkey",
                disclaimerRegionalTrContent: "This Site is subject to the regulations of the Republic of Turkey's Ministry of Health. The information herein should be interpreted within the framework of the 'Turkish Food Codex Regulation on Nutrition and Health Claims.' This site cannot be used for the prevention or treatment of diseases and makes no such claim.",
                disclaimerRegionalEuTitle: "For the European Union (EU)",
                disclaimerRegionalEuContent: "The EFSA data presented on the Site is based on the scientific opinions of the authority but does not constitute individual health advice. In accordance with the GDPR (General Data Protection Regulation), this Site does not collect or process any personal data.",
                disclaimerRegionalUsTitle: "For the United States of America (USA)",
                disclaimerRegionalUsContent: "These statements have not been evaluated by the Food and Drug Administration (FDA). The information provided on this Site is not intended to diagnose, treat, cure, or prevent any disease.",
                disclaimerIpTitle: "4. Intellectual Property Notice",
                disclaimerIpContent: "The design, text, graphics, code, and all other content of this Site are protected by copyright. No material may be copied, reproduced, distributed, or otherwise used without the express written permission of the Site owner.",
                disclaimerRightsReserved: "All Rights Reserved."
            }
        };

        let currentLang = 'tr'; // Default language

        // --- GLOBAL VARIABLES ---
        let charts = [];
        const sourceColors = {
            EFSA: 'rgba(54, 162, 235, 1)',
            FNB: 'rgba(255, 99, 132, 1)',
            TFC: 'rgba(75, 192, 192, 1)'
        };
        const sourceBorderDash = {
            EFSA: [],
            FNB: [5, 5],
            TFC: [10, 5, 2, 5]
        };

        // --- LANGUAGE SWITCHING ---
        function switchLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            const t = translations[lang];

            document.getElementById('main-title').textContent = t.title;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('nutrient-select-label').textContent = t.nutrientSelectLabel;
            document.getElementById('controls-title').textContent = t.controlsTitle;
            
            document.getElementById('disclaimer-title').textContent = t.disclaimerTitle;
            document.getElementById('disclaimer-last-updated').textContent = t.disclaimerLastUpdated;
            document.getElementById('disclaimer-intro').textContent = t.disclaimerIntro;
            document.getElementById('disclaimer-general-title').textContent = t.disclaimerGeneralTitle;
            document.getElementById('disclaimer-general-content').textContent = t.disclaimerGeneralContent;
            document.getElementById('disclaimer-medical-advice').textContent = t.disclaimerMedicalAdvice;
            document.getElementById('disclaimer-accuracy-title').textContent = t.disclaimerAccuracyTitle;
            document.getElementById('disclaimer-accuracy-content').textContent = t.disclaimerAccuracyContent;
            document.getElementById('disclaimer-regional-title').textContent = t.disclaimerRegionalTitle;
            document.getElementById('disclaimer-regional-tr-title').textContent = t.disclaimerRegionalTrTitle;
            document.getElementById('disclaimer-regional-tr-content').textContent = t.disclaimerRegionalTrContent;
            document.getElementById('disclaimer-regional-eu-title').textContent = t.disclaimerRegionalEuTitle;
            document.getElementById('disclaimer-regional-eu-content').textContent = t.disclaimerRegionalEuContent;
            document.getElementById('disclaimer-regional-us-title').textContent = t.disclaimerRegionalUsTitle;
            document.getElementById('disclaimer-regional-us-content').textContent = t.disclaimerRegionalUsContent;
            document.getElementById('disclaimer-ip-title').textContent = t.disclaimerIpTitle;
            document.getElementById('disclaimer-ip-content').textContent = t.disclaimerIpContent;
            document.getElementById('disclaimer-rights-reserved').textContent = t.disclaimerRightsReserved;

            const selectElement = document.getElementById('nutrient-select');
            const placeholder = selectElement.querySelector('option[value=""]');
            if (placeholder) {
                placeholder.textContent = t.selectPlaceholder;
            }
            
            // Re-render the charts with the new language
            const selectedNutrient = selectElement.value;
            if (selectedNutrient) {
                renderCharts(selectedNutrient, lang);
            }
        }

        // --- UTILITY FUNCTIONS ---
        function createSteppedData(data) {
            const points = [];
            data.sort((a,b) => a.age_start - b.age_start).forEach(item => {
                points.push({ x: item.age_start, y: item.value });
                points.push({ x: item.age_end, y: item.value });
                const nextItemIndex = data.indexOf(item) + 1;
                if (nextItemIndex < data.length) {
                    if (data[nextItemIndex].age_start > item.age_end) {
                        points.push({ x: item.age_end, y: null });
                    }
                }
            });
            return points;
        }

        // --- CHARTING FUNCTIONS ---
        function clearCharts() {
            charts.forEach(chart => chart.destroy());
            charts = [];
            document.getElementById('charts-wrapper').innerHTML = '';
        }

        function renderCharts(nutrientName, lang = 'tr') {
            clearCharts();
            const nutrientData = micronutrientData.filter(d => d.nutrient === nutrientName);
            if (nutrientData.length === 0) return;

            const unit = nutrientData[0].unit;
            const t = translations[lang];

            const intakeData = nutrientData.filter(d => ['AI', 'AR', 'PRI', 'RI', 'Safe and adequate intake', 'RDA', 'DRV'].includes(d.type));
            const ulData = nutrientData.filter(d => ['UL', 'DML'].includes(d.type));
            
            const wrapper = document.createElement('div');
            wrapper.className = 'bg-white p-4 sm:p-6 rounded-xl shadow-lg';
            wrapper.innerHTML = `
                <h2 class="text-xl md:text-2xl font-bold text-center mb-6 text-gray-800">${nutrientName}</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="chart-container">
                        <canvas id="intake-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="ul-chart"></canvas>
                    </div>
                </div>
            `;
            document.getElementById('charts-wrapper').appendChild(wrapper);

            createChart(
                `intake-chart`,
                t.intakeChartTitle,
                intakeData,
                t.yAxisLabel(unit),
                lang
            );
            createChart(
                `ul-chart`,
                t.ulChartTitle,
                ulData,
                t.yAxisLabel(unit),
                lang
            );
            
            const selectedNutrient = document.getElementById('nutrient-select').value;
            if (selectedNutrient) {
                setupControls();
            }
        }
        
        function createChart(canvasId, title, data, yAxisLabel, lang = 'tr') {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            const t = translations[lang];
            const datasets = [];
            const sources = ['EFSA', 'FNB', 'TFC'];
            
            sources.forEach(source => {
                const sourceData = data.filter(d => d.source === source);
                const types = [...new Set(sourceData.map(d => d.type))];

                types.forEach(type => {
                    const typeData = sourceData.filter(d => d.type === type);
                    if (typeData.length === 0) return;

                    const genders = [...new Set(typeData.map(d => d.gender))];
                    const hasGenderSpecificData = genders.includes('Male') || genders.includes('Female');

                    if (hasGenderSpecificData) {
                        const maleData = typeData.filter(d => d.gender === 'Male' || d.gender === 'Both');
                        const femaleData = typeData.filter(d => d.gender === 'Female' || d.gender === 'Both');

                        if (maleData.length > 0) {
                            datasets.push({
                                label: `${source} - ${type} (${t.genderMale})`,
                                data: createSteppedData(maleData),
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                borderWidth: 2.5,
                                pointRadius: 0,
                                stepped: 'before',
                                borderDash: sourceBorderDash[source],
                                spanGaps: true,
                            });
                        }
                        if (femaleData.length > 0) {
                            datasets.push({
                                label: `${source} - ${type} (${t.genderFemale})`,
                                data: createSteppedData(femaleData),
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderWidth: 2.5,
                                pointRadius: 0,
                                stepped: 'before',
                                borderDash: sourceBorderDash[source],
                                spanGaps: true,
                            });
                        }
                    } else {
                        if (genders.includes('Both')) {
                            const bothData = typeData.filter(d => d.gender === 'Both');
                             datasets.push({
                                label: `${source} - ${type}`,
                                data: createSteppedData(bothData),
                                borderColor: sourceColors[source],
                                backgroundColor: sourceColors[source].replace('1)', '0.2)'),
                                borderWidth: 2.5,
                                pointRadius: 0,
                                stepped: 'before',
                                borderDash: sourceBorderDash[source],
                                spanGaps: true,
                            });
                        }
                    }
                });
            });

            if (datasets.length === 0) {
                const p = document.createElement('p');
                p.className = 'flex items-center justify-center h-full text-gray-500';
                p.textContent = t.noDataMessage;
                ctx.parentElement.innerHTML = '';
                ctx.parentElement.appendChild(p);
                return;
            }

            const chart = new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: title, font: { size: 16 } },
                        legend: { display: true, position: 'bottom' },
                        tooltip: { 
                            mode: 'index', 
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y;
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: t.xAxisLabel },
                            min: 0,
                            max: 18,
                            ticks: { stepSize: 2 }
                        },
                        y: {
                            title: { display: true, text: yAxisLabel },
                            beginAtZero: true
                        }
                    }
                }
            });
            charts.push(chart);
            
            ['EFSA', 'FNB', 'TFC'].forEach(source => {
                const checkbox = document.getElementById(`${source}-checkbox`);
                if (checkbox) {
                    const isVisible = checkbox.checked;
                     chart.data.datasets.forEach(dataset => {
                        if (dataset.label.startsWith(source)) {
                            dataset.hidden = !isVisible;
                        }
                    });
                }
            });
            chart.update();
        }

        // --- CONTROLS AND INITIALIZATION ---
        function setupControls() {
            const controlsDiv = document.getElementById('checkbox-controls');
            controlsDiv.innerHTML = ''; 
            const sources = ['EFSA', 'FNB', 'TFC'];
            
            sources.forEach(source => {
                const color = sourceColors[source];
                const controlHtml = `
                    <label for="${source}-checkbox" class="flex items-center cursor-pointer">
                        <input type="checkbox" id="${source}-checkbox" class="custom-checkbox appearance-none h-5 w-5 rounded border-2 transition duration-200" style="color: ${color}; border-color: ${color};" checked>
                        <span class="ml-2 text-md font-medium text-gray-700">${source}</span>
                    </label>
                `;
                controlsDiv.innerHTML += controlHtml;
            });

            sources.forEach(source => {
                document.getElementById(`${source}-checkbox`).addEventListener('change', (e) => {
                    const isVisible = e.target.checked;
                    charts.forEach(chart => {
                        chart.data.datasets.forEach(dataset => {
                            if (dataset.label.startsWith(source)) {
                                dataset.hidden = !isVisible;
                            }
                        });
                        chart.update();
                    });
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const selectElement = document.getElementById('nutrient-select');
            const nutrients = [...new Set(micronutrientData.map(d => d.nutrient))].sort();
            const t = translations[currentLang];

            const placeholder = document.createElement('option');
            placeholder.value = "";
            placeholder.textContent = t.selectPlaceholder;
            placeholder.disabled = true;
            selectElement.appendChild(placeholder);

            nutrients.forEach(nutrient => {
                const option = document.createElement('option');
                option.value = nutrient;
                option.textContent = nutrient;
                selectElement.appendChild(option);
            });

            selectElement.addEventListener('change', (e) => {
                if (e.target.value) {
                    renderCharts(e.target.value, currentLang);
                }
            });
            
            // Set Biotin as default and render its chart
            selectElement.value = 'Biotin';
            renderCharts('Biotin', currentLang);

            setupControls();
            switchLanguage(currentLang);
        });

    </script>
</body>
</html>
